# Full project: https://gitlab.com/pages/plain-html
stages:
  - release
  - deploy
pages:
  stage: deploy
  script:
    - mkdir .public
    - cp -r * .public
    - mv .public public
  artifacts:
    paths:
      - public
  only:
    - master

publishing:
    stage: release
    only:
         - master
    script: 
         - 'which ssh-agent || ( apt-get update -y && apt-get install openssh-client -y )'
         - eval $(ssh-agent -s)
         - echo "$SSH_PRIVATE_KEY" | tr -d '\r' | ssh-add -
         - git config --global user.email "Tunisiano18@wazebelgium.be"
         - git config --global user.name "Tunisiano18"
         - script_version=$(cat WME-send-to-slack.user.js | grep @version | tr -s " " | cut -d " " -f3)
         - git tag -a $script_version -m "Version created by Tunisiano18"
         - git tag
         - git remote set-url origin git@gitlab.com:WMEScripts/wme-send-to-slack-public.git
         - GIT_SSH_COMMAND="ssh -o StrictHostKeyChecking=no" git push origin HEAD:master
        # - git push origin $script_version
        # - git push origin :refs/tags/v4